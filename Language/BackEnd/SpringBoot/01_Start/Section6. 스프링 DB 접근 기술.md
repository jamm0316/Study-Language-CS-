[<back](https://www.notion.so/Spring-2cf44a3f25f542dfbcc88e2390cee6e3?pvs=21)

---

<aside>
ğŸ“ƒ ëª©ì°¨

</aside>

---

## H2 ë°ì´í„° ë² ì´ìŠ¤ ì„¤ì¹˜

- H2 Database Engine ì‚¬ìš©
    - ê°œë°œì´ë‚˜ í…ŒìŠ¤íŠ¸ ìš©ë„ë¡œ ê°€ë³ê³  í¸ë¦¬í•œ DB, ì›¹ í™”ë©´ ì œê³µ
- **ì„¤ì¹˜ë°©ë²•**
    - https://www.h2database.com/html/main.html í™ˆí˜ì´ì§€ ì ‘ì† â†’ All Plaform ë‹¤ìš´ë¡œë“œ â†’ ì•Œì§‘ í’€ê¸°
        
        ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/6b8d40ba-5287-42be-84df-56b1c96a2c05/35feee01-50e8-4512-931c-98f0beff0193/image.png)
        
    - `cd h2` â†’ `cd bin` â†’ `ls -arlth` â†’ `chmod 755 h2.sh`(ì‹¤í–‰ê¶Œí•œ ë¶€ì—¬) â†’ `./h2.sh`
        
        ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/6b8d40ba-5287-42be-84df-56b1c96a2c05/41f7e6c3-2eed-4381-b1f0-a27721441481/image.png)
        
    - ì›¹ í™”ë©´ ì‹¤í–‰ â†’ ì—°ê²° í´ë¦­
        
        ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/6b8d40ba-5287-42be-84df-56b1c96a2c05/164e8d12-4620-4a5e-90f9-edc7345a7385/image.png)
        
    - ì¢Œì¸¡ ìƒë‹¨ ë¹¨ê°„ìƒ‰ `ì—°ê²° ëŠê¸°` ë²„íŠ¼ í´ë¦­
        
        ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/6b8d40ba-5287-42be-84df-56b1c96a2c05/9f0d1027-98fc-4e74-af7a-4902d3a23766/image.png)
        
    - terminal ìš°í´ë¦­ â†’ New Window í´ë¦­
        
        ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/6b8d40ba-5287-42be-84df-56b1c96a2c05/e01cc1da-7246-4291-8023-de7a6b84af0c/image.png)
        
    - `ls -arlth` â†’ `test.mv.db`ê°€ ìˆëŠ”ì§€ í™•ì¸
        
        ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/6b8d40ba-5287-42be-84df-56b1c96a2c05/9013f186-f762-4ee1-abd5-1c0ac99d9e04/image.png)
        
    - **JDBC URL**
        - `jdbc:h2:**~/test**`: ì—¬ê¸°ì„œ `~/test`ëŠ” ë‚´ í™ˆí™”ë©´ì— ìˆëŠ” testíŒŒì¼ ê²½ë¡œë¥¼ ë§í•˜ëŠ” ê²ƒ.
            - íŒŒì¼ë¡œ ì ‘ê·¼í•˜ê²Œ ë˜ë©´ ì›¹ì½˜ì†”ê³¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ë™ì‹œ ì ‘ì†ì´ ì•ˆë˜ëŠ” ê²½ìš° ë°œìƒ
                
                ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/6b8d40ba-5287-42be-84df-56b1c96a2c05/782e9a7c-a8a2-4d2a-a204-d209fb8978d0/image.png)
                
                â†’ ì˜¤ë¥˜ ë°œìƒì˜ ì›ì¸
                
    - `jdbc:h2:tcp://localhost/~/test` : tcpì†Œì¼“ì„ í†µí•´ ì ‘ê·¼í•˜ë©´ ì—¬ëŸ¬êµ°ë°ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë‹¤.
        
        ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/6b8d40ba-5287-42be-84df-56b1c96a2c05/99c9f7c5-de4b-42b2-aa38-c6c1f33e65f0/image.png)
        
    - ë¬¸ì œ ìˆì„ ì‹œ
        - `ì—°ê²° ëŠê¸°` í›„ í„°ë¯¸ë„ì„ í†µí•´ `test.mv.db`ë¥¼ ì§€ìš´ë‹¤.
            - `rm test.mv.db`
        - ì„œë²„ ë‚´ë¦°ë‹¤.
        - [`cd h2` â†’ `cd bin` â†’ `ls -arlth` â†’ `chmod 755 h2.sh`(ì‹¤í–‰ê¶Œí•œ ë¶€ì—¬) â†’ `./h2.sh`](https://www.notion.so/cd-h2-cd-bin-ls-arlth-chmod-755-h2-sh-h2-sh-93535e0581ba4e799b9031c725cef5af?pvs=21) ì—¬ê¸°ì„œ ë¶€í„° ë‹¤ì‹œ ì‹œì‘
1. **MEMBER table ë§Œë“¤ê¸°**
    
    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/6b8d40ba-5287-42be-84df-56b1c96a2c05/e18cc7cb-a5ab-46cf-9550-7860fa1d8b88/image.png)
    
    ```
    create table member
    (
        id bigint generated by default as identity,
        name varchar(255),
        primary key (id)
    );
    ```
    
    - ì…ë ¥ í›„ â†’ `ctrl + enter`
    - í•´ì„
        - ë„ë©”ì¸ì˜ id, nameì„ ë„£ìŒ
        - id: Java Long íƒ€ì… â†’ SQL bigint íƒ€ì…
        - name: String íƒ€ì… â†’ varchar íƒ€ì…
        - PKëŠ” idë¡œ ì¡ìŒ

1. **MEMBER table ì¡°íšŒ**
    - ì§ì ‘ íƒ€ì´í•‘
        
        ```
        select * from member
        ```
        
        ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/6b8d40ba-5287-42be-84df-56b1c96a2c05/3e910d3b-e9a2-4f24-ab20-94cae31c4a97/image.png)
        
    
    - SQLë¬¸: ì°½ì´ ëª¨ë‘ ì§€ì›Œì§„ ìƒíƒœì—ì„œ MEMBERë¥¼ í´ë¦­í•˜ë©´ í•´ë‹¹ ì‹¤í–‰ë¬¸ì´ ìë™ ì…ë ¥ë¨.
        
        
        ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/6b8d40ba-5287-42be-84df-56b1c96a2c05/aa44e633-8f6b-477b-a09c-7937836304e8/image.png)
        
        ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/6b8d40ba-5287-42be-84df-56b1c96a2c05/7763c51c-b6f0-49fd-a1f7-adad861a5d55/image.png)
        
2. **ë°ì´í„° ì…ë ¥**
    
    ```
    insert into member(name) values('spring')
    ```
    
    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/6b8d40ba-5287-42be-84df-56b1c96a2c05/2915eed9-310b-4ece-8dc5-1ed50a197b7f/image.png)
    
    - ì…ë ¥ëœ ë°ì´í„° í™•ì¸
        
        ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/6b8d40ba-5287-42be-84df-56b1c96a2c05/12f3574d-7804-4c99-b519-dc94e8949ce6/image.png)
        
    
    ```
    insert into member(name) value('spring2')
    select * from member
    ```
    
    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/6b8d40ba-5287-42be-84df-56b1c96a2c05/7ab88d0d-496f-47d1-9666-2d9967faebe0/image.png)
    
    - `name`ì„ ì§€ì •í•˜ì§€ ì•Šì•„ë„ ì œë„ˆë ˆì´í„°ë¡œ ì¸í•´ 1ì”© ì¦ê°€í•¨.
        - `repository` ë˜í•œ `setId(++sequence);` ë¡œ ì¸í•´ `Id`ê°€ `1`ì”© ì¦ê°€í•¨.
            
            ```java
            @Override
            public Member save(Member member) {
                member.setId(++sequence);
                store.put(member.getId(), member);
                return member;
            ```
            
3. ë°ì´í„° ê´€ë¦¬

`hello-spring copy/sql/ddl.sql`

**ddl.sql**

```java
create table member
(
    id bigint generated by default as identity,
    name varchar(255),
    primary key (id)
);
```

## ìˆœìˆ˜ Jdbc

### í™˜ê²½ ì„¤ì •

**build.gradle íŒŒì¼ì— jdbc, h2 ë°ì´í„°ë² ì´ìŠ¤ ê´€ë ¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€**

`hello-spring copy/build.gradle`

**build.gradle**

```java
implementation 'org.springframework.boot:spring-boot-starter-jdbc'
runtimeOnly 'com.h2database:h2'
```

`hello-spring copy/src/main/resources/application.properties`

**application.properties**

```java
spring.datasource.url=jdbc:h2:tcp://localhost/~/test
spring.datasource.username=sa
spring.datasource.driver-class-name=org.h2.Driver
```

- ì½”ë¼ë¦¬ ë¦¬í”„ë ˆì‰¬ ë²„íŠ¼ í´ë¦­ â†’ `org.h2.Driver` ì¸ìŠ¤í†¨ ë¨
- ì—¬ê¸°ì„œ `spring.datasource.username=sa` ì½”ë“œë¥¼ ì…ë ¥í•˜ì§€ ì•Šì„ ì‹œ, dbì˜ ì‚¬ìš©ì ì´ë¦„ì„ ì°¾ì„ ìˆ˜ ì—†ì–´ ì—°ê²°ì´ ë˜ì§€ ì•ŠìŒ.

`hello-spring/src/main/java/hello/hello_spring/repository/JdbcMemberRepository.java`

**JdbcMemberRepository.java**

```java
package hello.hello_spring.repository;
import hello.hello_spring.domain.Member;
import org.springframework.jdbc.datasource.DataSourceUtils;
import javax.sql.DataSource;
import java.sql.*;
import java.util.ArrayList;
import java.util.List;
import java.util.Optional;
public class JdbcMemberRepository implements MemberRepository {
    private final DataSource dataSource;
    public JdbcMemberRepository(DataSource dataSource) {
        this.dataSource = dataSource;
    }
    @Override
    public Member save(Member member) {
        String sql = "insert into member(name) values(?)";
        Connection conn = null;
        PreparedStatement pstmt = null;
        ResultSet rs = null;
        try {
            conn = getConnection();
            pstmt = conn.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS);
            pstmt.setString(1, member.getName());
            pstmt.executeUpdate();
            rs = pstmt.getGeneratedKeys();
            if (rs.next()) {
                member.setId(rs.getLong(1));
            } else {
                throw new SQLException("id ì¡°íšŒ ì‹¤íŒ¨");
            }
            return member;
        } catch (Exception e) {
            throw new IllegalStateException(e);
        } finally {
            close(conn, pstmt, rs);
        }
    }
    @Override
    public Optional<Member> findById(Long id) {
        String sql = "select * from member where id = ?";
        Connection conn = null;
        PreparedStatement pstmt = null;
        ResultSet rs = null;
        try {
            conn = getConnection();
            pstmt = conn.prepareStatement(sql);
            pstmt.setLong(1, id);
            rs = pstmt.executeQuery();
            if(rs.next()) {
                Member member = new Member();
                member.setId(rs.getLong("id"));
                member.setName(rs.getString("name"));
                return Optional.of(member);
            } else {
                return Optional.empty();
            }
        } catch (Exception e) {
            throw new IllegalStateException(e);
        } finally {
            close(conn, pstmt, rs);
        }
    }
    @Override
    public List<Member> findAll() {
        String sql = "select * from member";
        Connection conn = null;
        PreparedStatement pstmt = null;
        ResultSet rs = null;
        try {
            conn = getConnection();
            pstmt = conn.prepareStatement(sql);
            rs = pstmt.executeQuery();
            List<Member> members = new ArrayList<>();
            while(rs.next()) {
                Member member = new Member();
                member.setId(rs.getLong("id"));
                member.setName(rs.getString("name"));
                members.add(member);
            }
            return members;
        } catch (Exception e) {
            throw new IllegalStateException(e);
        } finally {
            close(conn, pstmt, rs);
        }
    }
    @Override
    public Optional<Member> findByName(String name) {
        String sql = "select * from member where name = ?";
        Connection conn = null;
        PreparedStatement pstmt = null;
        ResultSet rs = null;
        try {
            conn = getConnection();
            pstmt = conn.prepareStatement(sql);
            pstmt.setString(1, name);
            rs = pstmt.executeQuery();
            if(rs.next()) {
                Member member = new Member();
                member.setId(rs.getLong("id"));
                member.setName(rs.getString("name"));
                return Optional.of(member);
            }
            return Optional.empty();
        } catch (Exception e) {
            throw new IllegalStateException(e);
        } finally {
            close(conn, pstmt, rs);
        }
    }
    private Connection getConnection() {
        return DataSourceUtils.getConnection(dataSource);
    }
    private void close(Connection conn, PreparedStatement pstmt, ResultSet rs) {
        try {
            if (rs != null) {
                rs.close();
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }
        try {
            if (pstmt != null) {
                pstmt.close();
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }
        try {
            if (conn != null) {
                close(conn);
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
    private void close(Connection conn) throws SQLException {
        DataSourceUtils.releaseConnection(conn, dataSource);
    }
}
```

- DataSourceëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ì„ íšë“í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ê°ì²´. ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ DataSourceë¥¼ ìƒì„±í•˜ê³  ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë§Œë“¤ì–´ì¤€ë‹¤. ê·¸ë˜ì„œ DIë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤.

**êµ¬í˜„ í´ë˜ìŠ¤ ì¶”ê°€ ì´ë¯¸ì§€**

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/6b8d40ba-5287-42be-84df-56b1c96a2c05/c2a91402-e1af-4166-81e8-9ef6c360e3e6/aa6a21e9-3adf-4ed5-b35d-e99a873dd4a8.png)

**ìŠ¤í”„ë§ ì„¤ì • ì´ë¯¸ì§€**

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/6b8d40ba-5287-42be-84df-56b1c96a2c05/001e8741-a250-4da5-afaa-3b89ae32ca3e/5dece439-1df4-4428-8dfe-443459ef6dc1.png)

- ê°œë°© íì‡„ ì›ì¹™ (OCP: Open-Closed Principle)
    - í™•ì¥ì—ëŠ” ì—´ë ¤ìˆê³  ìˆ˜ì •, ë³€ê²½ì—ëŠ” ë‹«í˜€ìˆë‹¤.
- ìŠ¤í”„ë§ DI(Dependencies Injection)ë¥¼ ì´ìš©í•˜ë©´, **ê¸°ì¡´ ì½”ë“œë¥¼ ì „í˜€ ì†ëŒ€ì§€ ì•Šê³ , ì„¤ì •ë§Œìœ¼ë¡œ êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ë³€ê²½**í•  ìˆ˜ ìˆë‹¤.
- íšŒì›ì„ ë“±ë¡í•˜ê³  DBì— ê²°ê³¼ê°€ ì˜ ì…ë ¥ëëŠ”ì§€ í™•ì¸
- ë°ì´í„°ë¥¼ DBì— ì €ì¥í•˜ë¯€ë¡œ ìŠ¤í”„ë§ ì„œë²„ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•´ë„ ë°ì´í„°ê°€ ì•ˆì „í•˜ê²Œ ì €ì¥ë¨.

## ìŠ¤í”„ë§ í†µí•© í…ŒìŠ¤íŠ¸

ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì™€ DBê¹Œì§€ ì—°ê²°í•œ í†µí•© í…ŒìŠ¤íŠ¸ ì§„í–‰

`hello-spring/src/test/java/hello/hello_spring/service/MemberServiceIntergrationTest.java`

**MemberServiceIntergrationTest.java**

```java
package hello.hello_spring.service;
...

@SpringBootTest
//@Transactional
class MemberServiceIntergrationTest {

    @Autowired MemberService memberService;
    @Autowired MemberRepository memberRepository;
```

**ì‹¤í–‰ ê²°ê³¼**

```java
java.lang.IllegalStateException: ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.
```

- ìœ„ì—ì„œ ì´ë¯¸ `spring`ì´ë¼ëŠ” ì´ë¦„ì„ ê°€ì§„ íšŒì›ì„ ë“±ë¡í–ˆê³ , DBì—ì„œ ì‹¤í–‰í•˜ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— DBë¥¼ í´ë¦¬ì–´ í•´ì£¼ì–´ì•¼í•¨.
    
    ```java
    delete from member
    ```
    
    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/6b8d40ba-5287-42be-84df-56b1c96a2c05/74d53eaf-b5f2-49f1-b1dc-1b9e578789a6/image.png)
    
    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/6b8d40ba-5287-42be-84df-56b1c96a2c05/e4d683f7-500a-4556-95c6-4ad5eec86486/image.png)
    
- `MemberServiceIntergrationTest.java` ****ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´, DBì— í•´ë‹¹ ì´ë¦„ì´ ì˜¬ë¼ê°€ë©° í…ŒìŠ¤íŠ¸ê°€ ì§„í–‰ëœë‹¤.
- ê·¸ëŸ¬ë‚˜ í…ŒìŠ¤íŠ¸ëŠ” ì„œë¡œ ì˜í–¥ì„ ì£¼ë©´ ì•ˆëœë‹¤. í•˜ì§€ë§Œ DBì— ë°ì´í„°ê°€ ì˜¬ë¼ê°€ëŠ” ìˆœê°„ ë‹¤ë¥¸ í…ŒìŠ¤íŠ¸ì— ì˜í–¥ì„ ì¤Œ
- ì´ì— ë”°ë¼ `@Transaction` ì• ë…¸í…Œì´ì…˜ì´ í•„ìš”.
    - íŠ¸ë Œì ì…˜ì´ ê±¸ê³  ì¸ì„œíŠ¸ ì¿¼ë¦¬ í›„ í…ŒìŠ¤íŠ¸ê°€ ëë‚˜ë©´ ë¡¤ë°±í•œë‹¤.
        
        â†’ `@Transaction`ì• ë…¸í…Œì´ì…˜ì„ í†µí•´ í…ŒìŠ¤íŠ¸ê°€ ì‹œì‘ë˜ë©´ì„œ ë°ì´í„°ê°€ ì¸ì„œíŠ¸ ë˜ê³ , í…ŒìŠ¤íŠ¸ê°€ ëë‚˜ë©´ ì˜¬ë¼ê°€ìˆë˜ ë°ì´í„°ë“¤ì´ ëª¨ë‘ ë¡¤ë°±ëœë‹¤.
        

**MemberServiceIntergrationTest.java**

```java
package hello.hello_spring.service;
...

@SpringBootTest
//@Transactional
class MemberServiceIntergrationTest {

    @Autowired MemberService memberService;
    @Autowired MemberRepository memberRepository;
```

**ì‹¤í–‰ê²°ê³¼**

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/6b8d40ba-5287-42be-84df-56b1c96a2c05/a80455b4-e2d3-400b-b102-47ab5f0979f4/image.png)

- `@SpringBootTest`: ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì™€ í…ŒìŠ¤íŠ¸ë¥¼ í•¨ê»˜ ì‹¤í–‰.
- `@Transactional`: í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ì— ì´ ì• ë…¸í…Œì´ì…˜ì´ ìˆìœ¼ë©´, í…ŒìŠ¤íŠ¸ ì‹œì‘ ì „ì— íŠ¸ëœì ì…˜ì„ ì‹œì‘í•˜ê³ , í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„ì— í•­ìƒ ë¡¤ë°±í•œë‹¤. ì´ë ‡ê²Œ í•˜ë©´ DBì— ë°ì´í„°ê°€ ë‚¨ì§€ ì•Šìœ¼ë¯€ë¡œ ë‹¤ìŒ í…ŒìŠ¤íŠ¸ì— ì˜í–¥ ì£¼ì§€ ì•ŠëŠ”ë‹¤.

## ìŠ¤í”„ë§ JdbcTemplate

- ìˆœìˆ˜ Jdbcì™€ ë™ì¼í•œ í™˜ê²½ì„¤ì •ì„ í•˜ë©´ ëœë‹¤.
- ìŠ¤í”„ë§ Jdbc Templateê³¼ MyBatis ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” JDBC APIì—ì„œ ë³¸ ë°˜ë³µ ì½”ë“œë¥¼ ëŒ€ë¶€ë¶„ ì œê±°í•´ì¤€ë‹¤. í•˜ì§€ë§Œ SQLì€ ì§ì ‘ ì‘ì„±í•´ì•¼í•œë‹¤.

**ìŠ¤í”„ë§ JdbcTemplate íšŒì› ë¦¬í¬ì§€í† ë¦¬**

```java
package hello.hello_spring.repository;

import hello.hello_spring.domain.Member;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.jdbc.core.namedparam.MapSqlParameterSource;
import org.springframework.jdbc.core.simple.SimpleJdbcInsert;

import javax.sql.DataSource;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.*;

public class JdbcTemplateMemberRepository implements MemberRepository {

    private final JdbcTemplate jdbcTemplate;

    //@Autowired  -> ìƒì„±ìê°€ í•˜ë‚˜ë§Œ ìˆìœ¼ë©´ ìŠ¤í”„ë§ ë¹ˆì´ ìë™ìœ¼ë¡œ ì¸ì ì…˜ì„ ë„ì™€ì¤Œ, ë”°ë¼ì„œ @Autowired ìƒëµ ê°€ëŠ¥
    public JdbcTemplateMemberRepository(DataSource dataSource) {
        jdbcTemplate = new JdbcTemplate(dataSource);
    }

    @Override
    public Member save(Member member) {
        SimpleJdbcInsert jdbcInsert = new SimpleJdbcInsert(jdbcTemplate);
        jdbcInsert.withTableName("member").usingGeneratedKeyColumns("id");

        Map<String, Object> parameters = new HashMap<>();
        parameters.put("name", member.getName());

        Number key = jdbcInsert.executeAndReturnKey(new MapSqlParameterSource(parameters));
        member.setId(key.longValue());
        return member;
    }

    @Override
    public Optional<Member> findById(Long id) {
        List<Member> result = jdbcTemplate.query("select * from member where id = ?", memberRowMapper(), id);
        return result.stream().findAny();
    }

    @Override
    public Optional<Member> findByName(String name) {
        List<Member> result = jdbcTemplate.query("select * from member where name = ?", memberRowMapper(), name);
        return result.stream().findAny();    }

    @Override
    public List<Member> findAll() {
        return jdbcTemplate.query("select * from member", memberRowMapper());
    }

    private RowMapper<Member> memberRowMapper() {
        return (rs, rowNum) -> {
            Member member = new Member();
            member.setId(rs.getLong("id"));
            member.setName(rs.getString("name"));
            return member;
        };
    }
}
```

## JPA

- JPAëŠ” ê¸°ì¡´ì˜ ë°˜ë³µ ì½”ë“œëŠ” ë¬¼ë¡ ì´ê³ , ê¸°ë³¸ì ì¸ SQLë„ JPAê°€ ì§ì ‘ ë§Œë“¤ì–´ì„œ ì‹¤í–‰í•´ì¤€ë‹¤.
- JPAë¥¼ ì‚¬ìš©í•˜ë©´, SQLê³¼ ë°ì´í„° ì¤‘ì‹¬ì˜ ì„¤ê³„ì—ì„œ ê°ì²´ ì¤‘ì‹¬ì˜ ì„¤ê³„ë¡œ íŒ¨ëŸ¬ë‹¤ì„ì„ ì „í™˜í•  ìˆ˜ ìˆë‹¤.
- JPAë¥¼ ì‚¬ìš©í•˜ë©´ ê°œë°œ ìƒì‚°ì„±ì„ í¬ê²Œ ë†’ì¼ ìˆ˜ ìˆë‹¤.

`hello-spring/build.gradle`

**build.gradle**

```java
dependencies {
	implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'
	implementation 'org.springframework.boot:spring-boot-starter-web'
	implementation 'org.springframework.boot:spring-boot-starter-jdbc'
	**implementation 'org.springframework.boot:spring-boot-starter-data-jpa'**
	runtimeOnly 'com.h2database:h2'
	testImplementation 'org.springframework.boot:spring-boot-starter-test'
	testRuntimeOnly 'org.junit.platform:junit-platform-launcher'
```

`implementation 'org.springframework.boot:spring-boot-starter-data-jpa'` ì¶”ê°€

â†’`gradle refresh` 

`hello-spring/src/main/resources/application.properties`

**application.properties**

```java
spring.application.name=hello-spring
spring.datasource.url=jdbc:h2:tcp://localhost/~/test
spring.datasource.username=sa
spring.datasource.driver-class-name=org.h2.Driver
**spring.jpa.show-sql=true
spring.jpa.hibernate.ddl-auto=none**
```

`hello-spring/src/main/java/hello/hello_spring/repository/JpaMemberRepository.java`

**JpaMemberRepository.java**

```java
package hello.hello_spring.repository;

import hello.hello_spring.domain.Member;
import jakarta.persistence.EntityManager;

import java.util.List;
import java.util.Optional;

public class JpaMemberRepository implements MemberRepository {

    private final EntityManager em;

    public JpaMemberRepository(EntityManager em) {
        this.em = em;
    }

    @Override
    public Member save(Member member) {
        return null;
    }

    @Override
    public Optional<Member> findById(Long id) {
        return Optional.empty();
    }

    @Override
    public Optional<Member> findByName(String name) {
        return Optional.empty();
    }

    @Override
    public List<Member> findAll() {
        return List.of();
    }
}
```

## ìŠ¤í”„ë§ ë°ì´í„° JPA

ìŠ¤í”„ë§ ë¶€íŠ¸ì™€ JPAë§Œ ì‚¬ìš©í•´ë„ ê°œë°œ ìƒì‚°ì„±ì´ ë§ì´ ì¦ê°€í•¨.

ê°œë°œí•´ì•¼í•  ì½”ë“œë„ í™•ì—°íˆ ì¤„ì–´ë“ ë‹¤.

ì—¬ê¸°ì— ìŠ¤í”„ë§ ë°ì´í„° JPAë¥¼ ì‚¬ìš©í•˜ë©´, ê¸°ì¡´ì˜ í•œê³„ë¥¼ ë¦¬í¬ì§€í† ë¦¬ì— êµ¬í˜„ í´ë˜ìŠ¤ ì—†ì´ ì¸í„°í˜ì´ìŠ¤ë§Œìœ¼ë¡œ ê°œë°œì„ ì™„ë£Œí•  ìˆ˜ ìˆë‹¤.

ê·¸ë¦¬ê³  ë°˜ë³µ ê°œë°œí•´ì˜¨ ê¸°ë³¸ CRUD ê¸°ëŠ¥ë„ ìŠ¤í”„ë§ ë°ì´í„° JPAê°€ ëª¨ë‘ ì œê³µ.

ì§€ê¸ˆê¹Œì§€ ì¡°ê¸ˆì´ë¼ë„ ë‹¨ìˆœí•œê³  ë°˜ë³µì´ë¼ ìƒê°í–ˆë˜ ê°œë°œ ì½”ë“œë“¤ì´ í™•ì—°íˆ ì¤„ì–´ë“¤ê³  í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê°œë°œì— ì§‘ì¤‘ ê°€ëŠ¥.

> **ì£¼ì˜: ìŠ¤í”„ë§ ë°ì´í„° JPAëŠ” JPAë¥¼ í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•˜ë„ë¡ ë„ì™€ì£¼ëŠ” ê¸°ìˆ . ë”°ë¼ì„œ JPAë¥¼ ë¨¼ì € í•™ìŠµí•œ í›„ ìŠ¤í”„ë§ JPAí•™ìŠµ ê¶Œì¥**
> 

`hello-spring/src/main/java/hello/hello_spring/repository/SringDataJpaMemberRepository.java` 

**SpringDataJpaMemberRepository.java**

```java
package hello.hello_spring.repository;

import hello.hello_spring.domain.Member;
import org.springframework.data.jpa.repository.JpaRepository;

import java.util.Optional;

public interface SringDataJpaMemberRepository extends JpaRepository<Member, Long>, MemberRepository {

    @Override
    Optional<Member> findByName(String name);
}
```

`hello-spring/src/main/java/hello/hello_spring/SpringConfig.java`

**SpringConfig.java**

```java
package hello.hello_spring;

import hello.hello_spring.repository.*;
import hello.hello_spring.service.MemberService;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import javax.sql.DataSource;

@Configuration
public class SpringConfig {

    private final MemberRepository memberRepository;

    public SpringConfig(MemberRepository memberRepository) {
        this.memberRepository = memberRepository;
    }

    @Bean
    public MemberService memberService() {
        return new MemberService(memberRepository);
    }
}
```

- ìŠ¤í”„ë§ë°ì´í„° JPAê°€ `SpringDataJpaMemberRepository`ë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ìë™ ë“±ë¡í•´ì¤Œ

**ìŠ¤í”„ë§ ë°ì´í„° JPA ì œê³µ í´ë˜ìŠ¤**

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/6b8d40ba-5287-42be-84df-56b1c96a2c05/3618ea3f-32cf-40e7-9733-613c36b15256/8362ecf4-c5a3-4be0-a7b8-6d09a107a436.png)

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/6b8d40ba-5287-42be-84df-56b1c96a2c05/11986d1b-8249-4d0e-910c-1c9c53ed7656/97757844-ec32-4e8f-b7c2-da68a0597f65.png)

**ìŠ¤í”„ë§ ë°ì´í„° JPA ì œê³µ ê¸°ëŠ¥**

- ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•œ ê¸°ë³¸ì ì¸ CRUD
- `findName()`, `findByEmail()` ì²˜ëŸ¼ ë©”ì„œë“œ ì´ë¦„ë§Œìœ¼ë¡œ ì¡°íšŒ ê°€ëŠ¥.
- í˜ì´ì§• ê¸°ëŠ¥ ìë™ ì œê³µ

> ì°¸ê³ : ì‹¤ë¬´ì—ì„œëŠ” JPAì™€ ìŠ¤í”„ë§ ë°ì´í„° JPAë¥¼ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©, ë³µì¡í•œ ë™ì  ì¿¼ë¦¬ëŠ” Querydslì´ë¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©. Querydslì„ ì‚¬ìš©í•˜ë©´ ì¿¼ë¦¬ë„ ìë°” ì½”ë“œë¡œ ì•ˆì „í•˜ê²Œ ì‘ì„±í•  ìˆ˜ ìˆê³ , ë™ì  ì¿¼ë¦¬ë„ í¸ë¦¬í•˜ê²Œ ì‘ì„±ê°€ëŠ¥. ì´ ì¡°í•©ìœ¼ë¡œ í•´ê²°í•˜ê¸° ì–´ë ¤ìš´ ì¿¼ë¦¬ëŠ” JPAê°€ ì œê³µí•˜ëŠ” ë„¤ì´í‹°ë¸Œ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜, ì•ì„œ í•™ìŠµí•œ ìŠ¤í”„ë§ JdbcTemplateë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
>